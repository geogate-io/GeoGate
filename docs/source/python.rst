.. _python:

******
Python
******

========================================
Plugin Specific Third-party Dependencies
========================================

Python plugin requires following third-party libraries/tools to function:

- `Conduit Library <https://llnl-conduit.readthedocs.io/en/latest/>`_
- `Python <https://www.python.org>`_ and other third-party modules that will be used.

.. note::
  All dependencies can be installed using combination of `Spack <https://spack.io>`_ and Python (i.e., `pip <https://pip.pypa.io/en/stable/#>`_, `Conda <https://conda-forge.org>`_) package managers. Please refer to Installation section for more detail.

===========================================
Building GeoGate with Python Plugin Support
===========================================

To build Catalyst plugin user needs to provide ``-DGEOGATE_USE_PYTHON=ON`` CMake option in build time. Otherwise, GeoGate will not build with Python plugin support.

=============================
Runtime Configuration Options
=============================

In GeoGate, each specific plugin comes with its own set of runtime configuration options. For the Python plugin, users can specify the following options:

- **PythonScripts:** This option allows users to provide a list of Python scripts, which can be used to process or generate data. The list can be provided as a double-column-separated list like ``"scriptA.py:scriptB.py"``.

The GeoGate can create its own export state, which is the basic data object utilized by the ESMF library for exchanging data among model components. In this scenario, users must provide the following additional run-time configuration options.

.. note::
  More information about the ESMF State class can be found in the `ESMF reference manual <https://earthsystemmodeling.org/docs/nightly/develop/ESMF_refdoc/node4.html#SECTION04070000000000000000>`_.

- **ExportMeshFile:** This refers to the ESMF mesh file that will be utilized to create the underlying mesh for the ESMF fields attached to the ESMF export state.

- **ExportFields:** This refers to the list of export fields that will be created on the GeoGate export state. You can provide the list in one of two formats: as a double-column-separated list (e.g., "fieldA:fieldB") or as a YAML-formatted list (e.g., [fieldA, fieldB]), which is applicable if you are using ESMX as a driver component.

.. note::
  ESMF supports a custom unstructured grid file format for describing meshes. This format is more compatible than the SCRIP format with the methods used to create an ESMF Mesh object, which reduces the amount of conversion required to create a Mesh. For more information about the format of the ESMF Mesh file, refer to the `ESMF reference documentation <https://earthsystemmodeling.org/docs/nightly/develop/ESMF_refdoc/node3.html#SECTION03028200000000000000>`_.

=======================
Interacting with Python
=======================

The interaction with the Python script is primarily managed by the Conduit library. The GeoGate generic data component is implemented in Fortran, a programming language that does not support direct interaction with Python. Consequently, any data transferred from GeoGate to Python, or data generated by the Python script that must be sent back to GeoGate, must traverse multiple programming layers written in different languages, including Fortran, C/C++, and Python. 

The Conduit library provides an API that supports Fortran, C/C++, and Python to describe hierarchal data using a JSON-inspired data model and a dynamic API for rapid construction and consumption of hierarchical objects.

To access the nodes provided by the GeoGate, the user needs to use the Conduit Python module that is explained in `The Conduit Python Tutorial <https://llnl-conduit.readthedocs.io/en/latest/tutorial_python.html>`_.

Import: Data consumed by Python
-------------------------------

The Conduit node named ``my_node`` can be accessed from Python to process data provided by the GeoGate. Please refer to the Conduit User Guide for more information about the `Conduit nodes <https://llnl-conduit.readthedocs.io/en/latest/tutorial_python_basics.html#node-basics>`_.

The ``my_node`` includes the following information in a hierarchical way:

.. code-block:: json


Export: Data produced by Python
-------------------------------

The Conduit node named ``my_node_return`` can be accessed from Python to provide data to GeoGate, and update the fields in the export state. In this case, the ``my_node_return['data/fields/fieldA/values']`` statement can be used to access the specific field found in the GeoGate export state.

.. note:
  The name of the fields used in the ``my_node_return['data/fields/fieldA/values']`` statement needs to match with the field names given in the ``ExportFields`` runtime configuration option.

===========
Limitations
===========

Running Python script in parallel could be tricky.
